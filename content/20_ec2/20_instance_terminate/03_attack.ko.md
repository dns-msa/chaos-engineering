---
title: "3. Attack - 특정 AZ의 EC2 노드 인스턴스 중단"
chapter: false
weight: 23
---

## 예상 결과 정의

데모 애플리케이션은 인스턴스가 중단되어도 새로운 인스턴스가 자동으로 시작되어 정상적인 비즈니스 처리가 가능해야 합니다.

---

## 공격대상 서비스 선택 및 장애주입

실험을 위해 review 서비스에서 사용하는 EC2 인스턴스를 한 대 Terminate 합니다.

TODO: FIS 상세항목 캡쳐 및 추가설명



---

## 모니터링 도구를 통한 관찰

---

## 실제 결과 확인

새로운 EC2 인스턴스가 정상적으로 실행되었으나, 해당 인스턴스의 CPU 사용률이 올라가지 않고 해당 인스턴스에서는 요청이 처리되지 않습니다.

TODO: CloudWatch 상세항목 캡쳐 및 추가설명

---

## Action Item 도출 및 적용

무엇이 잘못되었는지 확인해보겠습니다.

review 서비스가 사용하는 EC2 인스턴스 2대 중에 1대가 Terminate되고 새로운 인스턴스가 시작하면서 인스턴스의 IP가 변경되었습니다. product-composite 서비스에서는 유레카를 이용하여 서비스 디스커버리를 사용하기 때문에, 새로운 인스턴스가 등록되면 정상적으로 해당 인스턴스로 트래픽을 전달할 수 있어야 합니다.

하지만, product-composite의 설정오류로 유레카를 이용한 처리가 아닌 static IP를 이용하여 라우팅이 처리되고 있었습니다. 따라서 새로운 IP로 시작된 인스턴스로는 트래픽이 전달되지 않았습니다.

TODO: 애플리케이션 설정항목 캡쳐 및 추가설명

---

## 그룹토론

실험 계획과 예상 결과를 작성해보기 (5분 작성 / 10분 발표 토론)

---

## 실험 반복을 통한 개선사항 확인

유레카를 이용하여 서비스 디스커버리를 할 수 있도록 애플리케이션의 설정을 변경하여 적용하겠습니다.

2.5.4로 돌아가서 다시 실험을 진행합니다. 원하는 대로 새로운 인스턴스가 시작되고, 트래픽이 정상적으로 처리되는지 확인합니다.

TODO: 애플리케이션 수정 배포변경 관련 캡쳐 및 추가설명

---
포스트모텀 - 실패로부터 배우기
온프레미스 환경과 다르게 클라우드 환경은 IP를 이용하여 통신하지 않습니다. 하지만 팀의 구성원이 이에 익숙하지 않은 경우도 많이 있습니다.

클라우드 환경과 마이크로서비스에서의 서비스 디스커버리와 같은 패턴을 이해할 수 있도록 지속적인 팀의 교육이 필요합니다.

또한 유연한 설정관리와 가시성을 위해 설정이 애플리케이션 내부에 포함되지 않도록 설정을 외부화하는 방안을 적용할 필요가 있습니다.
